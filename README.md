# Caasp end-to-end tests

This project hosts the end-to-end tests for the Caasp platform. They are meant to be run against
a CaaSP Cluster

This can be either a production environment installed from images, or a [caasp-devenv](https://github.com/kubic-project/caasp-devenv)

Unit and feature tests can also be found in the [velum project](https://github.com/kubic-project/velum).

## Tools

This project is using [Rspec](http://rspec.info/) and [Capybara](http://www.rubydoc.info/gems/capybara)
(with Phantomjs driver) to interact with Velum.

## Running the tests

First you need to have a running CaaSP cluster with `velum` ready to register the first user, and at least 2 minions up and running.

To make sure the tests know where to run against you need to specify a `environment.json` file path. This file is usually generated by a [terraform](https://github.com/kubic-project/terraform) setup.

### 1. local cluster generated via [caasp-devenv](https://github.com/kubic-project/caasp-devenv) and [terraform](https://github.com/kubic-project/terraform)

**NOTE**: for this setup make sure to remove provide `DEVENV=true` as all `docker` commands will run on localhost without any ssh access. You can just use the `environment.json` file generated by the [terraform](https://github.com/kubic-project/terraform) setup
```json
{
  "minions": [
    {
      "fqdn": "minion0.k8s.local",
      "ipv4": "10.17.3.129",
      "role": "master"
    },
    {
      "fqdn": "minion1.k8s.local",
      "ipv4": "10.17.3.192",
      "role": "worker"
    },
    {
      "fqdn": "minion2.k8s.local",
      "ipv4": "10.17.3.204",
      "role": "worker"
    }
  ],
  "dashboardHost": "10.160.5.85",
  "kubernetesHost": "10.17.3.129",
  "sshKey": "/home/$USER/caasp/terraform/ssh/id_docker",
  "sshUser": "root"
}
```

```
VERBOSE=true DEVENV=true ENVIRONMENT=/home/$USER/caasp/terraform/environment.json bundle exec rspec spec/**/*
```

### 2. production cluster installed via official images

**NOTE**: to be able to run commands in the application containers make sure your public ssh key is in the authorized_keys on the minions
**NOTE**: for this setup make sure to specify `dashboardHost` and `sshKey` as all `docker` commands will run on minions through ssh tunnels. You can just use the `environment.json` file generated by the [terraform](https://github.com/kubic-project/terraform) setup
```json
{
  "minions": [
    {
      "fqdn": "minion0.k8s.local",
      "ipv4": "10.17.3.129",
      "role": "master"
    },
    {
      "fqdn": "minion1.k8s.local",
      "ipv4": "10.17.3.192",
      "role": "worker"
    },
    {
      "fqdn": "minion2.k8s.local",
      "ipv4": "10.17.3.204",
      "role": "worker"
    }
  ],
  "dashboardHost": "10.160.5.85",
  "kubernetesHost": "10.17.3.129",
  "sshKey": "/home/$USER/caasp/terraform/ssh/id_docker",
  "sshUser": "root"
}
```

```
VERBOSE=true ENVIRONMENT=/home/$USER/caasp/terraform/environment.json bundle exec rspec spec/**/*
```

## License

This project is licensed under the Apache License, Version 2.0. See
[LICENSE](https://github.com/kubic-project/e2e-tests/blob/master/LICENSE) for the full
license text.
